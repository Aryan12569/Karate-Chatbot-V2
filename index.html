<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KarateBot Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen">
        <!-- Header -->
        <div class="bg-red-800 text-white p-4">
            <h1 class="text-2xl font-bold">KarateBot Admin</h1>
            <p class="text-red-200">Leads from Google Sheets</p>
        </div>

        <!-- Stats Cards -->
        <div class="p-4 grid grid-cols-1 md:grid-cols-4 gap-4" id="statsCards">
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500">Total Leads</p>
                        <h3 class="text-3xl font-bold" id="totalLeads">0</h3>
                    </div>
                    <i data-feather="users" class="text-red-600"></i>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500">Ready to Join</p>
                        <h3 class="text-3xl font-bold" id="registerNow">0</h3>
                    </div>
                    <i data-feather="check-circle" class="text-green-600"></i>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500">Interested Later</p>
                        <h3 class="text-3xl font-bold" id="registerLater">0</h3>
                    </div>
                    <i data-feather="clock" class="text-yellow-600"></i>
                </div>
            </div>
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-500">Last Updated</p>
                        <h3 class="text-xl font-bold" id="lastUpdated">--:--:--</h3>
                    </div>
                    <i data-feather="refresh-cw" class="text-blue-600"></i>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="p-4">
            <button onclick="loadData()" class="bg-red-700 text-white px-4 py-2 rounded flex items-center gap-2">
                <i data-feather="refresh-cw"></i>
                Refresh Data
            </button>
        </div>

        <!-- Leads Table -->
        <div class="p-4">
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="p-4 border-b">
                    <h3 class="text-lg font-bold">All Leads</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Timestamp</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Contact</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Intent</th>
                            </tr>
                        </thead>
                        <tbody id="leadsTable" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="4" class="px-6 py-4 text-center text-gray-500">Loading data from Google Sheets...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Status -->
        <div class="p-4">
            <div id="status" class="text-sm text-gray-600"></div>
        </div>
    </div>

    <script>
        feather.replace();

        const API_URL = "https://karate-chatbot-v2.onrender.com/api/leads";

        // Load data from Google Sheets via your Flask API
        async function loadData() {
            console.log("Loading data from:", API_URL);
            showStatus("Loading data from Google Sheets...", "blue");
            
            try {
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const leads = await response.json();
                console.log("Data received:", leads);
                
                updateDashboard(leads);
                showStatus(`Data loaded successfully! ${leads.length} leads found.`, "green");
                
            } catch (error) {
                console.error("Error loading data:", error);
                showStatus(`Error: ${error.message}`, "red");
            }
        }

        function updateDashboard(leads) {
            // Update stats
            document.getElementById('totalLeads').textContent = leads.length;
            document.getElementById('registerNow').textContent = 
                leads.filter(lead => lead.Intent === 'Register Now').length;
            document.getElementById('registerLater').textContent = 
                leads.filter(lead => lead.Intent === 'Register Later').length;
            document.getElementById('lastUpdated').textContent = 
                new Date().toLocaleTimeString();

            // Update table
            const table = document.getElementById('leadsTable');
            table.innerHTML = '';

            if (leads.length === 0) {
                table.innerHTML = '<tr><td colspan="4" class="px-6 py-4 text-center text-gray-500">No leads found in Google Sheets</td></tr>';
                return;
            }

            leads.forEach(lead => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${lead.Timestamp || ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${lead.Name || ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${lead.Contact || ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 rounded-full text-xs ${
                            lead.Intent === 'Register Now' 
                                ? 'bg-green-100 text-green-800' 
                                : 'bg-yellow-100 text-yellow-800'
                        }">
                            ${lead.Intent || ''}
                        </span>
                    </td>
                `;
                table.appendChild(row);
            });
        }

        function showStatus(message, color) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `text-sm ${
                color === 'green' ? 'text-green-600' : 
                color === 'red' ? 'text-red-600' : 
                'text-blue-600'
            }`;
        }

        // Load data when page opens
        document.addEventListener('DOMContentLoaded', loadData);

        // Auto-refresh every 30 seconds
        setInterval(loadData, 30000);
    </script>
</body>
</html>